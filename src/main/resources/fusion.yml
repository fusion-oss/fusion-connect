fusion:
  sources:
    endpoint:
      - name: kafka_order_drop
        type:
          - activemq|kafka|http|direct
        uri: camel uri
        spec:
          format:
            - json|xml|avro
          eventType:
            path: $.eventType
      - name: activemq_pick_begin
        type:
          - activemq|kafka|http|direct
        uri: camel uri
        spec:
          format:
            - json|xml|avro
          eventType:
            path: $.eventType
  targets:
    endpoint:
      - name: activemq_order_drop
        type:
          - activemq|kafka|http|direct
        uri: :order_drop.${header.nodeId}.out
      - name: kafka_pick_begin
        type:
          - activemq|kafka|http|direct
        uri: camel uri
      - name: audit
        type:
          - activemq|kafka|http|direct
        uri: camel uri
  events:
    - eventType: orderDrop
      header:
        - key: "nodeId"
          value: [static|jsonPath|xpath]
        - key: "countryCode"
          value: [static|jsonPath|xpath]
        - key: "configLookupKey"
          value: [static|jsonPath|xpath]
      spec:
        - key: "default"
          actions:
            validate:
              schema: jsd/xsd/schema - order_drop.jsd
              onFailure:
                target:
                  - type:
                      - activemq|kafka|http|direct
                    uri: camel uri
            audit:
              enabled:
                - true/false
              target: audit
            idempotence:
              enabled:
                - true/false
              key:
                expression: static/jsonPath/xpath
              onDuplicate:
                - continue/stop
            transform:
              template:
                path: order_drop.ftl
            target: activemq_order_drop

        - key: '5260:regular:1'
          actions:
            transform:
              template:
                path: order_drop_xyz.ftl